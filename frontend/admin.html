<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <title>Admin Panel - Scholarship Management</title>
    <style>
        :root { --white: #ffffff; --blue-main: #667eea; --text-dark: #2d3748; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f4f7fa; }
        .navbar { background: var(--white); padding: 1rem 0; box-shadow: 0 2px 20px rgba(0,0,0,0.08); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.8rem; font-weight: 800; color: var(--blue-main); text-decoration: none; }
        .back-btn { background: #4299e1; color: white; padding: 10px 20px; border: none; border-radius: 12px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; }
        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
        .admin-header { text-align: center; margin-bottom: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 20px; border-radius: 20px; }
        .admin-header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
        .admin-section { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
        .section-title { font-size: 1.5rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #4a5568; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-right: 10px; }
        .btn:hover { transform: translateY(-2px); }
        .btn-danger { background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%); }
        .scholarship-list { margin-top: 20px; }
        .scholarship-item { background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #667eea; }
        .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .stat-number { font-size: 2rem; font-weight: 700; color: #667eea; }
        .stat-label { color: #718096; font-size: 0.9rem; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo"><i class="fas fa-graduation-cap"></i> EduPath Admin</a>
            <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Main Site</a>
        </div>
    </nav>
    <div class="container">
        <div class="admin-header">
            <h1><i class="fas fa-tools"></i> Admin Panel</h1>
            <p>Manage scholarships, view statistics, and moderate content</p>
        </div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-number" id="totalScholarships">0</div><div class="stat-label">Total Scholarships</div></div>
            <div class="stat-card"><div class="stat-number" id="activeScholarships">0</div><div class="stat-label">Active Scholarships</div></div>
            <div class="stat-card"><div class="stat-number" id="expiredScholarships">0</div><div class="stat-label">Expired Scholarships</div></div>
            <div class="stat-card"><div class="stat-number" id="totalUsers">0</div><div class="stat-label">Total Users</div></div>
        </div>
        <div class="admin-grid">
            <div class="admin-section">
                <h2 class="section-title"><i class="fas fa-plus-circle"></i> Add/Update Scholarship</h2>
                <form id="addScholarshipForm">
                    <input type="hidden" id="scholarshipId">
                    <div class="form-group"><label for="title">Title</label><input type="text" id="title" required></div>
                    <div class="form-group"><label for="amount">Amount</label><input type="text" id="amount" required></div>
                    <div class="form-group"><label for="details">Description</label><textarea id="details" rows="3" required></textarea></div>
                    <div class="form-group"><label for="deadline">Deadline</label><input type="date" id="deadline" required></div>
                    <div class="form-group"><label for="category">Category</label><select id="category" required><option value="general">General</option><option value="obc">OBC</option><option value="sc">SC</option><option value="st">ST</option><option value="ews">EWS</option></select></div>
                    <div class="form-group"><label for="minGPA">Min GPA</label><input type="number" id="minGPA" min="0" max="100"></div>
                    <div class="form-group"><label for="eligibleYears">Eligible Years</label><select id="eligibleYears" multiple><option value="12th">12th Grade</option><option value="1">1st Year</option><option value="2">2nd Year</option><option value="3">3rd Year</option><option value="4">4th Year</option><option value="postgrad">Postgrad</option></select></div>
                    <div class="form-group"><label for="link">Application Link</label><input type="url" id="link"></div>
                    <button type="submit" class="btn"><i class="fas fa-save"></i> Save Scholarship</button>
                    <button type="button" class="btn btn-danger" onclick="clearForm()">Clear</button>
                </form>
            </div>
            <div class="admin-section">
                <h2 class="section-title"><i class="fas fa-list"></i> Manage Scholarships</h2>
                <div id="scholarshipList" class="scholarship-list"></div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // --- 1. FIREBASE INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDoRHiwN9GjKxk8FCpeu7k3KUOggHzhGBw", // Your API Key
            authDomain: "scholarship-app-8ad28.firebaseapp.com",
            projectId: "scholarship-app-8ad28",
            storageBucket: "scholarship-app-8ad28.appspot.com",
            messagingSenderId: "297508787243",
            appId: "1:297508787243:web:5a8da903ea9225f172c66e"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const scholarshipsRef = db.collection('scholarships');
        const usersRef = db.collection('users');

        // --- 2. AUTH & ADMIN CHECK ---
        auth.onAuthStateChanged(user => {
            if (user) {
                usersRef.doc(user.uid).get().then(doc => {
                    if (doc.exists && doc.data().isAdmin === true) {
                        console.log("Admin access granted.");
                        initializeApp();
                    } else {
                        alert("Access Denied. You are not an admin.");
                        window.location.href = 'index.html';
                    }
                });
            } else {
                window.location.href = 'logins.html';
            }
        });
        
        // --- 3. APP INITIALIZATION ---
        function initializeApp() {
            // Real-time listener for scholarships
            scholarshipsRef.onSnapshot(snapshot => {
                const allScholarships = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateScholarshipList(allScholarships);
                updateStats(allScholarships);
            }, error => console.error("Error fetching scholarships: ", error));

            // Get user count
            usersRef.get().then(snap => {
                document.getElementById('totalUsers').textContent = snap.size;
            });
        }
        
        // --- 4. FORM HANDLING & CRUD ---
        const form = document.getElementById('addScholarshipForm');
        form.addEventListener('submit', e => {
            e.preventDefault();
            const id = document.getElementById('scholarshipId').value;
            const scholarshipData = {
                title: form.title.value,
                amount: form.amount.value,
                details: form.details.value,
                deadline: form.deadline.value,
                category: form.category.value,
                minGPA: form.minGPA.value ? parseFloat(form.minGPA.value) : null,
                eligibleYears: Array.from(form.eligibleYears.selectedOptions).map(opt => opt.value),
                link: form.link.value,
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            };

            if (id) { // Update existing
                scholarshipsRef.doc(id).update(scholarshipData)
                    .then(() => alert("Scholarship updated!"))
                    .catch(e => console.error("Error updating:", e));
            } else { // Add new
                scholarshipsRef.add(scholarshipData)
                    .then(() => alert("Scholarship added!"))
                    .catch(e => console.error("Error adding:", e));
            }
            clearForm();
        });

        function editScholarship(id, data) {
            document.getElementById('scholarshipId').value = id;
            form.title.value = data.title;
            form.amount.value = data.amount;
            form.details.value = data.details;
            form.deadline.value = data.deadline;
            form.category.value = data.category;
            form.minGPA.value = data.minGPA || '';
            form.link.value = data.link || '';
            // Set multiple select options
            Array.from(form.eligibleYears.options).forEach(opt => {
                opt.selected = data.eligibleYears && data.eligibleYears.includes(opt.value);
            });
            window.scrollTo(0, 0);
        }

        function deleteScholarship(id) {
            if (confirm("Are you sure you want to delete this scholarship?")) {
                scholarshipsRef.doc(id).delete().then(() => alert("Scholarship deleted."));
            }
        }

        function clearForm() {
            form.reset();
            document.getElementById('scholarshipId').value = '';
        }

        // --- 5. UI & STATS UPDATES ---
        function updateScholarshipList(allScholarships) {
            const listContainer = document.getElementById('scholarshipList');
            if (allScholarships.length === 0) {
                listContainer.innerHTML = '<p>No scholarships found.</p>';
                return;
            }
            listContainer.innerHTML = allScholarships.map(s => {
                const isExpired = new Date(s.deadline) < new Date();
                return `
                <div class="scholarship-item" style="${isExpired ? 'opacity:0.7; border-color:#f56565;' : ''}">
                    <h4>${s.title}</h4>
                    <p><strong>Deadline:</strong> ${s.deadline} ${isExpired ? '(Expired)' : ''}</p>
                    <div>
                       <button class="btn btn-sm" onclick='editScholarship("${s.id}", ${JSON.stringify(s).replace(/"/g, "&quot;")})'>Edit</button>
                       <button class="btn btn-sm btn-danger" onclick="deleteScholarship('${s.id}')">Delete</button>
                    </div>
                </div>`;
            }).join('');
        }

        function updateStats(allScholarships) {
            const now = new Date();
            document.getElementById('totalScholarships').textContent = allScholarships.length;
            document.getElementById('activeScholarships').textContent = allScholarships.filter(s => new Date(s.deadline) >= now).length;
            document.getElementById('expiredScholarships').textContent = allScholarships.filter(s => new Date(s.deadline) < now).length;
        }
    </script>
</body>
</html> -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <title>Admin Panel - Scholarship Management</title>
    <style>
        :root { --white: #ffffff; --blue-main: #667eea; --text-dark: #2d3748; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f4f7fa; }
        .navbar { background: var(--white); padding: 1rem 0; box-shadow: 0 2px 20px rgba(0,0,0,0.08); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.8rem; font-weight: 800; color: var(--blue-main); text-decoration: none; }
        .back-btn { background: #4299e1; color: white; padding: 10px 20px; border: none; border-radius: 12px; text-decoration: none; font-weight: 600; transition: all 0.3s ease; }
        .container { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
        .admin-header { text-align: center; margin-bottom: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 20px; border-radius: 20px; }
        .admin-header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px; }
        .admin-section { background: white; border-radius: 20px; padding: 30px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); }
        .section-title { font-size: 1.5rem; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #4a5568; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 16px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; transition: all 0.3s ease; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-right: 10px; }
        .btn:hover { transform: translateY(-2px); }
        .btn-danger { background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%); }
        .btn-special { background: linear-gradient(135deg, #38b2ac 0%, #319795 100%); margin-top: 15px;}
        .scholarship-list { margin-top: 20px; }
        .scholarship-item { background: #f8fafc; padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid #667eea; }
        .btn-sm { padding: 6px 12px; font-size: 0.8rem; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 15px; text-align: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .stat-number { font-size: 2rem; font-weight: 700; color: #667eea; }
        .stat-label { color: #718096; font-size: 0.9rem; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo"><i class="fas fa-graduation-cap"></i> EduPath Admin</a>
            <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Back to Main Site</a>
        </div>
    </nav>
    <div class="container">
        <div class="admin-header">
            <h1><i class="fas fa-tools"></i> Admin Panel</h1>
            <p>Manage scholarships, view statistics, and moderate content</p>
        </div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-number" id="totalScholarships">0</div><div class="stat-label">Total Scholarships</div></div>
            <div class="stat-card"><div class="stat-number" id="activeScholarships">0</div><div class="stat-label">Active Scholarships</div></div>
            <div class="stat-card"><div class="stat-number" id="expiredScholarships">0</div><div class="stat-label">Expired Scholarships</div></div>
            <div class="stat-card"><div class="stat-number" id="totalUsers">0</div><div class="stat-label">Total Users</div></div>
        </div>
        <div class="admin-grid">
            <div class="admin-section">
                <h2 class="section-title"><i class="fas fa-plus-circle"></i> Add/Update Scholarship</h2>
                <form id="addScholarshipForm">
                    <input type="hidden" id="scholarshipId">
                    <div class="form-group"><label for="title">Title</label><input type="text" id="title" required></div>
                    <div class="form-group"><label for="amount">Amount</label><input type="text" id="amount" required></div>
                    <div class="form-group"><label for="details">Description</label><textarea id="details" rows="3" required></textarea></div>
                    <div class="form-group"><label for="deadline">Deadline</label><input type="date" id="deadline" required></div>
                    <div class="form-group"><label for="category">Category</label><select id="category" required><option value="general">General</option><option value="obc">OBC</option><option value="sc">SC</option><option value="st">ST</option><option value="ews">EWS</option></select></div>
                    <div class="form-group"><label for="minGPA">Min GPA</label><input type="number" id="minGPA" min="0" max="100"></div>
                    <div class="form-group"><label for="eligibleYears">Eligible Years</label><select id="eligibleYears" multiple><option value="12th">12th Grade</option><option value="1">1st Year</option><option value="2">2nd Year</option><option value="3">3rd Year</option><option value="4">4th Year</option><option value="pg">Postgrad</option></select></div>
                    <div class="form-group"><label for="link">Application Link</label><input type="url" id="link"></div>
                    <button type="submit" class="btn"><i class="fas fa-save"></i> Save Scholarship</button>
                    <button type="button" class="btn btn-danger" onclick="clearForm()">Clear</button>
                </form>
                <button class="btn btn-special" onclick="uploadInitialData()">Upload Initial Data (Click Once)</button>
            </div>
            <div class="admin-section">
                <h2 class="section-title"><i class="fas fa-list"></i> Manage Scholarships</h2>
                <div id="scholarshipList" class="scholarship-list"></div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // --- YOUR INITIAL SCHOLARSHIP DATA ---
        const initialScholarships = {
            general: [
                { title: "SBI Asha Scholarship 2025-26", amount: "Up to ₹20 Lakh", details: "For school and college students, including those pursuing studies abroad.", deadline: "2025-10-31", image: "sbi.png", link: "https://www.sbi.co.in/web/corporate-banking/sbi-foundation", minGPA: null, incomeLimit: null, type: "general", minYear: 1, maxYear: 'pg', eligibleYears: ['1', '2', '3', '4', 'pg'] },
                { title: "National Overseas Scholarship (NOS)", amount: "Varies", details: "For SC/ST students for masters & PhD abroad.", deadline: "2025-03-31", image: "nos1.jpeg", link: "https://nosmsje.gov.in/", minGPA: 60, incomeLimit: 800000, type: "merit", minYear: 3, maxYear: 'pg', eligibleYears: ['3', '4', 'pg'] },
                { title: "Indira Gandhi Scholarship for Single Girl Child", amount: "₹6.25L", details: "For single girl children pursuing postgraduate studies.", deadline: "2025-03-31", image: "nos.png", link: "https://nosmsje.gov.in/", minGPA: null, incomeLimit: null, type: "general", minYear: 'pg', maxYear: 'pg', eligibleYears: ['pg'] },
                { title: "PM-USP Central Sector Scheme of Scholarship", amount: "Varies", details: "For meritorious students from low-income families to pursue higher education.", deadline: "Varies", image: "nsp.png", link: "https://scholarships.gov.in/", minGPA: null, incomeLimit: 450000, type: "need", minYear: 1, maxYear: 4, eligibleYears: ['1', '2', '3', '4'] },
                { title: "AICTE Saksham Scholarship Scheme", amount: "₹50,000 per annum", details: "For specially-abled students pursuing a technical diploma or degree.", deadline: "Varies", image: "aicte.jpeg", link: "https://www.aicte-india.org/", minGPA: null, incomeLimit: null, type: "special", minYear: 1, maxYear: 4, eligibleYears: ['1', '2', '3', '4'] }
            ],
            obc: [
                { title: "PM-YASASVI Post-Matric Scholarship", amount: "Up to ₹20,000 annually", details: "For OBC, EBC, and DNT students pursuing post-matriculation studies.", deadline: "2025-10-15", image: "nsp.png", link: "https://scholarships.gov.in/", minGPA: null, incomeLimit: 250000, type: "need", minYear: 1, maxYear: 4, eligibleYears: ['1', '2', '3', '4'] },
                { title: "Dr. Ambedkar Post Matric Scholarship for OBCs", amount: "Varies by state", details: "Financial support for OBC students pursuing higher education from Class 11 onwards.", deadline: "2025-11-30", image: "https://images.unsplash.com/photo-1541339907198-e08756dedf3f?q=80&w=600&auto=format&fit=crop", link: "https://socialjustice.gov.in/schemes", minGPA: null, incomeLimit: 200000, type: "need", minYear: 1, maxYear: 4, eligibleYears: ['1', '2', '3', '4'] },
                { title: "National Overseas Scholarship (NOS)", amount: "Varies by country", details: "For OBC students (and others) to pursue master's and Ph.D. degrees abroad.", deadline: "2025-10-24", image: "nos.png", link: "https://nosmsje.gov.in/", minGPA: 65, incomeLimit: 800000, type: "merit", minYear: 3, maxYear: 'pg', eligibleYears: ['3', '4', 'pg'] },
                { title: "National Fellowship for OBC Students (NF-OBC)", amount: "₹31,000 to ₹35,000 per month", details: "A fellowship for OBC students pursuing M.Phil. and Ph.D. degrees in Indian universities.", deadline: "2025-12-10", image: "nfobc.png", link: "https://nbcfdc.gov.in/", minGPA: 55, incomeLimit: null, type: "merit", minYear: 'pg', maxYear: 'pg', eligibleYears: ['pg'] }
            ],
            sc: [
                { title: "SC/ST Excellence Award", amount: "₹60,000", details: "State government scholarship for SC students.", deadline: "2025-01-10", image: "https://images.unsplash.com/photo-1600195077909-46e573870d99?q=80&w=600&auto=format&fit=crop", link: "#", minGPA: 50, incomeLimit: 250000, type: "merit", minYear: 1, maxYear: 4, eligibleYears: ['1', '2', '3', '4'] }
            ],
            st: [
                { title: "Tribal Development Scholarship", amount: "₹60,000", details: "Tribal development fund for ST students.", deadline: "2025-01-10", image: "https://images.unsplash.com/photo-1488190211105-8b0e65b80b4e?q=80&w=600&auto=format&fit=crop", link: "#", minGPA: null, incomeLimit: 300000, type: "need", minYear: 1, maxYear: 4, eligibleYears: ['1', '2', '3', '4'] }
            ],
            ews: [
                { title: "EWS Support Grant", amount: "₹45,000", details: "For economically weaker sections with valid certificate.", deadline: "2025-01-15", image: "https://images.unsplash.com/photo-1594642418391-7f9a8f460431?q=80&w=600&auto=format&fit=crop", link: "#", minGPA: null, incomeLimit: 250000, type: "need", minYear: 1, maxYear: 4, eligibleYears: ['1', '2', '3', '4'] }
            ]
        };
        
        // --- 1. FIREBASE INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDoRHiwN9GjKxk8FCpeu7k3KUOggHzhGBw", // Your API Key
            authDomain: "scholarship-app-8ad28.firebaseapp.com",
            projectId: "scholarship-app-8ad28",
            storageBucket: "scholarship-app-8ad28.appspot.com",
            messagingSenderId: "297508787243",
            appId: "1:297508787243:web:5a8da903ea9225f172c66e"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const scholarshipsRef = db.collection('scholarships');
        const usersRef = db.collection('users');

        // --- 2. AUTH & ADMIN CHECK ---
        auth.onAuthStateChanged(user => {
            if (user) {
                usersRef.doc(user.uid).get().then(doc => {
                    if (doc.exists && doc.data().isAdmin === true) {
                        console.log("Admin access granted.");
                        initializeApp();
                    } else {
                        alert("Access Denied. You are not an admin.");
                        window.location.href = 'index.html';
                    }
                });
            } else {
                window.location.href = 'logins.html';
            }
        });
        
        // --- 3. APP INITIALIZATION ---
        function initializeApp() {
            // Real-time listener for scholarships
            scholarshipsRef.onSnapshot(snapshot => {
                const allScholarships = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateScholarshipList(allScholarships);
                updateStats(allScholarships);
            }, error => console.error("Error fetching scholarships: ", error));

            // Get user count
            usersRef.get().then(snap => {
                document.getElementById('totalUsers').textContent = snap.size;
            });
        }
        
        // --- 4. FORM HANDLING & CRUD ---
        const form = document.getElementById('addScholarshipForm');
        form.addEventListener('submit', e => {
            e.preventDefault();
            const id = document.getElementById('scholarshipId').value;
            const scholarshipData = {
                title: form.title.value,
                amount: form.amount.value,
                details: form.details.value,
                deadline: form.deadline.value,
                category: form.category.value,
                minGPA: form.minGPA.value ? parseFloat(form.minGPA.value) : null,
                eligibleYears: Array.from(form.eligibleYears.selectedOptions).map(opt => opt.value),
                link: form.link.value,
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            };

            if (id) { // Update existing
                scholarshipsRef.doc(id).update(scholarshipData)
                    .then(() => alert("Scholarship updated!"))
                    .catch(e => console.error("Error updating:", e));
            } else { // Add new
                scholarshipsRef.add(scholarshipData)
                    .then(() => alert("Scholarship added!"))
                    .catch(e => console.error("Error adding:", e));
            }
            clearForm();
        });

        function editScholarship(id, data) {
            document.getElementById('scholarshipId').value = id;
            form.title.value = data.title;
            form.amount.value = data.amount;
            form.details.value = data.details;
            form.deadline.value = data.deadline;
            form.category.value = data.category;
            form.minGPA.value = data.minGPA || '';
            form.link.value = data.link || '';
            // Set multiple select options
            Array.from(form.eligibleYears.options).forEach(opt => {
                opt.selected = data.eligibleYears && data.eligibleYears.includes(opt.value);
            });
            window.scrollTo(0, 0);
        }

        function deleteScholarship(id) {
            if (confirm("Are you sure you want to delete this scholarship?")) {
                scholarshipsRef.doc(id).delete().then(() => alert("Scholarship deleted."));
            }
        }

        function clearForm() {
            form.reset();
            document.getElementById('scholarshipId').value = '';
        }

        // --- 5. UI & STATS UPDATES ---
        function updateScholarshipList(allScholarships) {
            const listContainer = document.getElementById('scholarshipList');
            if (allScholarships.length === 0) {
                listContainer.innerHTML = '<p>No scholarships found. Click "Upload Initial Data" to add them.</p>';
                return;
            }
            listContainer.innerHTML = allScholarships.map(s => {
                const isExpired = new Date(s.deadline) < new Date();
                return `
                <div class="scholarship-item" style="${isExpired ? 'opacity:0.7; border-color:#f56565;' : ''}">
                    <h4>${s.title}</h4>
                    <p><strong>Deadline:</strong> ${s.deadline} ${isExpired ? '(Expired)' : ''}</p>
                    <div>
                       <button class="btn btn-sm" onclick='editScholarship("${s.id}", ${JSON.stringify(s).replace(/"/g, "&quot;")})'>Edit</button>
                       <button class="btn btn-sm btn-danger" onclick="deleteScholarship('${s.id}')">Delete</button>
                    </div>
                </div>`;
            }).join('');
        }

        function updateStats(allScholarships) {
            const now = new Date();
            document.getElementById('totalScholarships').textContent = allScholarships.length;
            document.getElementById('activeScholarships').textContent = allScholarships.filter(s => new Date(s.deadline) >= now).length;
            document.getElementById('expiredScholarships').textContent = allScholarships.filter(s => new Date(s.deadline) < now).length;
        }

        // --- 6. NEW ONE-TIME UPLOAD FUNCTION ---
        function uploadInitialData() {
            if (!confirm("Are you sure you want to upload all initial scholarships to the database? This should only be done once.")) {
                return;
            }

            const uploadPromises = [];
            for (const category in initialScholarships) {
                initialScholarships[category].forEach(scholarship => {
                    const dataToUpload = { ...scholarship, category: category }; // Add the category field
                    uploadPromises.push(scholarshipsRef.add(dataToUpload));
                });
            }

            Promise.all(uploadPromises)
                .then(() => {
                    alert("Successfully uploaded all initial scholarships!");
                })
                .catch(error => {
                    console.error("Error during batch upload: ", error);
                    alert("An error occurred during the upload. Check the console.");
                });
        }
    </script>
</body>
</html>